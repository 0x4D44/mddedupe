# Coverage Analysis Report - mddedupe
Date: 2026-01-09

## Overview
The `mddedupe` project currently has high test coverage, with **132 passing unit tests** and **10 passing integration tests**. The core logic in `src/main.rs` is well-exercised, but there are specific edge cases and error paths that remain uncovered.

## Coverage Statistics
*   **Unit Tests:** 132 passed
*   **Integration Tests:** 10 passed
*   **Line Coverage:** High (Visual estimate >95%)

## Key Areas with Missing Coverage

### 1. Configuration & Environment
*   **`read_duration_from_env` Fallback:** The logic that defaults to a hardcoded duration when the environment variable is missing is not covered. Existing tests almost always set the environment variable or use the test override system.
    *   *Location:* `src/main.rs:171`

### 2. Symlink Handling (`follow_symlinks`)
*   **Symlink to File:** The specific branch in `filter_entry` that handles a symlink pointing to a file (returning `true` to include it) is not covered. Existing tests cover symlinks to directories.
    *   *Location:* `src/main.rs:367`
*   **Broken Symlinks:** The error handling branch for `metadata()` failures in `filter_entry` (e.g., broken symlinks) appears uncovered, despite an existing test (`test_follow_symlinks_missing_target_skips_safely`). This warrants investigation into how `WalkDir` interacts with the filter.
    *   *Location:* `src/main.rs:372`

### 3. Error Handling
*   **`hash_file` IO Errors:** Handling of IO errors during file hashing (e.g., locked files, permission denied) is not covered on Windows. The existing test `test_find_duplicates_hash_error_is_logged` is Unix-only.
    *   *Location:* `src/main.rs:510`
*   **`WalkDir` Iterator Errors:** The error handling loop for the directory walker (when `entry` is `Err`) is not covered. This typically happens when the walker encounters a directory it cannot read.
    *   *Location:* `src/main.rs:396`
*   **`install_ctrlc_handler` Cached State:** The logic that returns a cached error if `Ctrl+C` handler installation previously failed is not covered.
    *   *Location:* `src/main.rs:736`

### 4. Main Entry Point
*   **`main` Error Propagation:** The top-level error formatting and exit code logic in `main()` is not covered. This is typical for CLI apps where `run_app` is the primary test target.
    *   *Location:* `src/main.rs:1325-1335`

## Conclusion
The codebase is robust. Closing the remaining gaps (items 1-3) will bring coverage to near 100% for testable logic. Item 4 (`main`) and some cached state logic are lower priority or harder to test without refactoring.
