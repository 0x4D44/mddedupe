# mddedupe Code Coverage Assessment — 2025-11-05

## Methodology
- Command: `cargo llvm-cov --text --show-missing-lines`
- Test suite: `cargo test` (5 unit tests, all passing)
- Generated supplemental artifacts: `target/coverage.txt`, `target/coverage.json`, `target/coverage.lcov`

## Top-Level Metrics
- Line coverage: **69.23 %** (261 / 377 lines executed)
- Region coverage: **74.54 %** (606 / 813 regions executed)
- Function coverage: **68.18 %** (15 / 22 functions executed)

## Component Analysis

- **CLI entrypoint (`src/main.rs:296-386`)** – Unexercised.
  - Argument parsing, quiet-mode filtering, summary rendering, destructive-action confirmation, destination validation, and error exits all remain untested.
  - Consequence: the public interface, guard rails (`--force`, destination requirement), and user messaging could regress unnoticed.

- **Human-readable helpers**
  - `human_readable` (`src/main.rs:41-54`) only covers the <1 KB path; KB/MB/GB branches remain red. No assertions for rounding behavior.
  - `format_duration` (`src/main.rs:57-66`) is completely uncovered, leaving elapsed-time formatting unverified.

- **Filesystem safety utilities**
  - `get_unique_destination` (`src/main.rs:195-222`) never executes; collisions on move targets are untested, along with file stems lacking extensions or non-UTF8 names.
  - Error logging inside `process_duplicates` (`src/main.rs:262-264`) is dead in tests; rename/remove failure paths are not validated.

- **Duplicate detection pipeline**
  - Happy path is partially covered by `test_find_duplicates_optimized`, but:
    - Error branches when `WalkDir` or `metadata` fail (`src/main.rs:107-116`) are untouched.
    - Progress throttling/polling (`src/main.rs:118-123`, `142-147`) never hits due to small fixtures.
    - Wasted-space accumulation skip/edge cases (`src/main.rs:186-188`) only partially covered.

- **Action execution (`process_duplicates`)**
  - Move, trash, and delete actions each execute once, yet:
    - Destination conflict fallback via `get_unique_destination` (`src/main.rs:267-268`) remains untested because fixtures don’t create collisions.
    - Overall progress reporting loop executes minimal iterations; formatting branches stay red.
    - Branch coverage around simulated trashing lacks assertions for logging/output.

- **Tests module (`src/main.rs:388-568`)**
  - Provides baseline coverage for hashing, duplicate grouping, and action dispatch.
  - Missing scenarios: nested directories, large file sets triggering progress output, invalid file names, permission errors, forced vs. prompted flows, and CLI integration.

## High-Risk Gaps (Representative Uncovered Lines)
- `src/main.rs:57-65` — `format_duration` time formatting.
- `src/main.rs:95-123` — progress reporting, error handling during directory walk.
- `src/main.rs:195-220` — destination collision handling for move action.
- `src/main.rs:262-275` — invalid path logging and trash-mode messaging.
- `src/main.rs:296-385` — entire `main` control flow.
- `src/main.rs:342-343` — summary colorized output helper composed with `format_duration`.

## Observations
- Coverage is concentrated in lower-level helpers invoked directly by unit tests; user-facing behavior and resilience logic are largely untested.
- Because `main` is uncovered, mutation or refactoring risk is high: even catastrophic regressions (e.g., skipping confirmation before delete) would not be caught.
- Uncovered branches predominantly involve error handling, interactive UX, and large-scale dataset behavior—precisely the areas most likely to fail in production.
- Raising coverage to ≥ 98 % will require integration-style tests (probably via `assert_cmd`/`tempfile`) and broader fixture scenarios to exercise CLI paths, collision handling, and error branches.

